<!-- <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Library Management System</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
</head>
<body>
    <div class="container">
        <h1 class="mt-5">Library Management System</h1>

         Book Form 
        <h2 class="mt-4">Add a Book</h2>
        <form id="book-form">
            <input type="text" id="title" placeholder="Title" required>
            <input type="text" id="author" placeholder="Author" required>
            <input type="text" id="genre" placeholder="Genre">
            <input type="date" id="published_date">
            <button type="submit" class="btn btn-primary">Add Book</button>
        </form>

        <h2 class="mt-4">Books</h2>
        <ul id="book-list" class="list-group mt-3"></ul>

         Student Registration Form 
        <h2 class="mt-5">Student Registration</h2>
        <form id="student-form">
            <input type="text" id="student-name" placeholder="Name" required>
            <input type="text" id="rollnumber" placeholder="Roll Number" required>
            <select id="course" required>
                <option value="">Select Course</option>
                <option value="COE">COE</option>
                <option value="ECE">ECE</option>
                <option value="ENC">ENC</option>
                <option value="COPC">COPC</option>
            </select>
            <input type="number" id="book_id" placeholder="Book ID (if issued)">
            <button type="submit" class="btn btn-success">Register Student</button>
        </form>

        <h2 class="mt-4">Students</h2>
        <ul id="student-list" class="list-group mt-3"></ul>

         Status Section -
        <h2 class="mt-5">Book Return Status</h2>
        <ul id="status-list" class="list-group mt-3"></ul>




        <h2 class="mt-5">Update Book Return Status</h2>
        <form id="status-form">
            <input type="text" id="status-rollnumber" placeholder="Roll Number" required>
            <input type="number" id="status-bookid" placeholder="Book ID" required>
            <select id="status-returned" required>
                <option value="">Select Status</option>
                <option value="true">Returned</option>
                <option value="false">Not Returned</option>
            </select>
            <button type="submit" class="btn btn-warning">Update Status</button>
        </form>

        <h2 class="mt-4">Book Return Status List</h2>
        <ul id="status-list" class="list-group mt-3"></ul>

    </div>

    <script>
        fetch('/status')
            .then(response => response.json())
            .then(statuses => statuses.forEach(addStatusToList));

        function addStatusToList(status) {
            const li = document.createElement('li');
            li.className = 'list-group-item';
            li.textContent = `Roll No: ${status.rollnumber}, Book ID: ${status.book_id}, Returned: ${status.returned_status ? 'Yes' : 'No'}`;
            document.getElementById('status-list').appendChild(li);
        }






        document.getElementById('status-form').addEventListener('submit', function(event) {
            event.preventDefault();
            
            const rollnumber = document.getElementById('status-rollnumber').value;
            const book_id = document.getElementById('status-bookid').value;
            const returned_status = document.getElementById('status-returned').value === "true";

            fetch('/status', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ rollnumber, book_id, returned_status })
            })
            .then(response => response.json())
            .then(data => {
                addStatusToList(data);
                document.getElementById('status-form').reset();
            })
            .catch(error => console.error('Error:', error));
        });

        function addStatusToList(status) {
            const li = document.createElement('li');
            li.className = 'list-group-item';
            li.textContent = `Roll No: ${status.rollnumber}, Book ID: ${status.book_id}, Returned: ${status.returned_status ? 'Yes' : 'No'}`;
            document.getElementById('status-list').appendChild(li);
        }

        // Fetch existing statuses
        fetch('/status')
            .then(response => response.json())
            .then(statuses => statuses.forEach(addStatusToList));

        


            document.getElementById('book-form').addEventListener('submit', function(event) {
    event.preventDefault();

    const title = document.getElementById('title').value;
    const author = document.getElementById('author').value;
    const genre = document.getElementById('genre').value;
    const published_date = document.getElementById('published_date').value;

    fetch('/books', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ title, author, genre, published_date })
    })
    .then(response => response.json())
    .then(data => {
        addBookToList(data);
        document.getElementById('book-form').reset();
    })
    .catch(error => console.error('Error:', error));
});

function addBookToList(book) {
    const li = document.createElement('li');
    li.className = 'list-group-item';
    li.textContent = `Title: ${book.title}, Author: ${book.author}, Genre: ${book.genre}, Published: ${book.published_date}`;
    document.getElementById('book-list').appendChild(li);
}

// Fetch existing books on page load
fetch('/books')
    .then(response => response.json())
    .then(books => books.forEach(addBookToList))
    .catch(error => console.error('Error:', error));










// Function to handle form submission for Students
document.getElementById('student-form').addEventListener('submit', function(event) {
    event.preventDefault();

    const name = document.getElementById('student-name').value;
    const age = document.getElementById('student-age').value;
    const course = document.getElementById('student-course').value;

    fetch('/students', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ name, age, course })
    })
    .then(response => response.json())
    .then(data => {
        addStudentToList(data);
        document.getElementById('student-form').reset();
    })
    .catch(error => console.error('Error:', error));
});

// Function to add a student to the list
function addStudentToList(student) {
    const li = document.createElement('li');
    li.className = 'list-group-item';
    li.textContent = `Name: ${student.name}, Age: ${student.age}, Course: ${student.course}`;
    document.getElementById('student-list').appendChild(li);
}

// Fetch all students on page load
fetch('/students')
    .then(response => response.json())
    .then(students => students.forEach(addStudentToList))
    .catch(error => console.error('Error:', error));


// Function to handle form submission for Status
document.getElementById('status-form').addEventListener('submit', function(event) {
    event.preventDefault();

    const student_id = document.getElementById('status-student-id').value;
    const status_text = document.getElementById('status-text').value;

    fetch('/status', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ student_id, status_text })
    })
    .then(response => response.json())
    .then(data => {
        addStatusToList(data);
        document.getElementById('status-form').reset();
    })
    .catch(error => console.error('Error:', error));
});

// Function to add a status to the list
function addStatusToList(status) {
    const li = document.createElement('li');
    li.className = 'list-group-item';
    li.textContent = `Student ID: ${status.student_id}, Status: ${status.status_text}`;
    document.getElementById('status-list').appendChild(li);
}

// Fetch all statuses on page load
fetch('/status')
    .then(response => response.json())
    .then(statuses => statuses.forEach(addStatusToList))
    .catch(error => console.error('Error:', error));

    </script>
</body>
</html> -->
 



<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Library Management System</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
</head>
<body>
    <div class="container">
        <h1 class="mt-5">Library Management System</h1>

        <!-- Book Form -->
        <h2 class="mt-4">Add a Book</h2>
        <form id="book-form">
            <input type="text" id="title" name="title" placeholder="Title" class="form-control mb-2" required>
            <input type="text" id="author" name="author" placeholder="Author" class="form-control mb-2" required>
            <input type="text" id="genre" name="genre" placeholder="Genre" class="form-control mb-2">
            <input type="date" id="published_date" name="published_date" class="form-control mb-2">
            <button type="submit" class="btn btn-primary">Add Book</button>
        </form>

        <h2 class="mt-4">Books</h2>
        <ul id="book-list" class="list-group mt-3"></ul>

        <!-- Student Registration -->
        <h2 class="mt-4">Student Registration</h2>
        <form id="student-form">
            <input type="text" id="student-name" name="name" placeholder="Name" class="form-control mb-2" required>
            <input type="text" id="rollnumber" name="rollnumber" placeholder="Roll Number" class="form-control mb-2" required>
            <select id="course" name="course" class="form-control mb-2" required>
                <option value="">Select Course</option>
                <option value="COE">COE</option>
                <option value="ECE">ECE</option>
                <option value="ENC">ENC</option>
                <option value="COPC">COPC</option>
            </select>
            <input type="text" id="book_id" name="book_id" placeholder="Book ID Issued" class="form-control mb-2">
            <button type="submit" class="btn btn-success">Register Student</button>
        </form>

        <h2 class="mt-4">Students</h2>
        <ul id="student-list" class="list-group mt-3"></ul>

        <!-- Update Book Return Status -->
        <h2 class="mt-5">Update Book Return Status</h2>
        <form id="status-form">
            <input type="text" id="status-rollnumber" name="rollnumber" placeholder="Roll Number" class="form-control mb-2" required>
            <input type="number" id="status-bookid" name="book_id" placeholder="Book ID" class="form-control mb-2" required>
            <select id="status-returned" name="returned_status" class="form-control mb-2" required>
                <option value="">Select Status</option>
                <option value="true">Returned</option>
                <option value="false">Not Returned</option>
            </select>
            <button type="submit" class="btn btn-warning">Update Status</button>
        </form>

        <h2 class="mt-4">Book Return Status List</h2>
        <ul id="status-list" class="list-group mt-3"></ul>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            fetchData("/books", addBookToList);
            fetchData("/students", addStudentToList);
            fetchData("/status", addStatusToList);
        });

        function fetchData(url, callback) {
            fetch(url)
                .then(response => response.json())
                .then(data => data.forEach(callback))
                .catch(error => console.error("Error fetching data:", error));
        }

        function addBookToList(book) {
            const li = document.createElement("li");
            li.className = "list-group-item";
            li.textContent = `Title: ${book.title}, Author: ${book.author}, Genre: ${book.genre || "N/A"}, Published: ${book.published_date || "N/A"}`;
            document.getElementById("book-list").appendChild(li);
        }

        function addStudentToList(student) {
            if (!student.name || !student.rollnumber) return;
            const li = document.createElement("li");
            li.className = "list-group-item";
            li.textContent = `Name: ${student.name}, Roll No: ${student.rollnumber}, Course: ${student.course}, Issued Book ID: ${student.book_id || "None"}`;
            document.getElementById("student-list").appendChild(li);
        }

        function addStatusToList(status) {
            const li = document.createElement("li");
            li.className = "list-group-item";
            li.textContent = `Roll No: ${status.rollnumber}, Book ID: ${status.book_id}, Returned: ${status.returned_status ? "Yes" : "No"}`;
            document.getElementById("status-list").appendChild(li);
        }

        function submitForm(url, form, callback) {
            const formData = new FormData(form);
            const jsonData = Object.fromEntries(formData);

            if (jsonData.book_id) jsonData.book_id = parseInt(jsonData.book_id, 10) || null;
            if (jsonData.returned_status) jsonData.returned_status = jsonData.returned_status === "true";

            fetch(url, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(jsonData)
            })
                .then(response => response.json())
                .then(data => {
                    callback(data);
                    form.reset();
                })
                .catch(error => console.error("Error submitting form:", error));
        }

        document.getElementById("book-form").addEventListener("submit", function(event) {
            event.preventDefault();
            submitForm("/books", this, addBookToList);
        });

        document.getElementById("student-form").addEventListener("submit", function(event) {
            event.preventDefault();
            submitForm("/students", this, addStudentToList);
        });

        document.getElementById("status-form").addEventListener("submit", function(event) {
            event.preventDefault();
            submitForm("/status", this, addStatusToList);
        });
    </script>
</body>
</html>
